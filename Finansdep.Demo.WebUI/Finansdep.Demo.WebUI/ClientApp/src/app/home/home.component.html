<h1>Housing Value Prediction Demo</h1>
<p>
  <em>
    This is a demonstration of explainable prediction of housing values using machine learning. The data set used is the <a href="https://www.kaggle.com/anthonypino/melbourne-housing-market" target="_blank">Melbourne Housing Clearance Data (2016)</a> from Kaggle.
    Some useful resources:
    <ul>
      <li>
        <a href="/swagger" target="_blank">API Documentation</a>
      </li>
      <li>
        <a href="https://github.com/Fundator/finansdep-demo" target="_blank">Web application source code</a>
      </li>
      <li>
        <a href="https://github.com/Fundator/finansdep" target="_blank">MLFlow backend source code</a>
      </li>
    </ul>
  </em></p>
<p>
  Use the form below to specify the characteristics of the house you wish to predict a market value for. The prediction as well as its explanation will be shown below the form. 

</p>
<form #predictionForm="ngForm" (ngSubmit)="onSubmit(predictionForm.value)">

  <table class='table predictForm' style="width: 0%">
    <tbody>
      <tr>
        <td><label>Suburb:</label></td>
        <td>
          <!--<input name="Suburb" [(ngModel)]="predictionRequest.Suburb" placement="top" ngbTooltip="Eksempler kan være Fossegrenda, Flatåsen, Byneset, eller Krattsia">-->
          <select name="Suburb" [(ngModel)]="predictionRequest.Suburb" style="width:100%">
            <option *ngFor="let j of formData.Suburb" [value]="j">{{ j }}</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><label>Rooms:</label></td>
        <td>
          <input name="Rooms" [(ngModel)]="predictionRequest.Rooms" style="width:100%" required type="number">
        </td>
      </tr>
      <tr>
        <td><label>Type:</label></td>
        <td>
          <select name="Type" [(ngModel)]="predictionRequest.Type" style="width:100%">
            <option *ngFor="let j of formData.Type" [value]="j">{{ j }}</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><label>Method:</label></td>
        <td>
          <select name="Method" [(ngModel)]="predictionRequest.Method" style="width:100%">
            <option *ngFor="let j of formData.Method" [value]="j">{{ j }}</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><label>Post Code:</label></td>
        <td>
          <select name="PostCode" [(ngModel)]="predictionRequest.PostCode" style="width:100%">
            <option *ngFor="let j of formData.Postcode" [value]="j">{{ j }}</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><label>Region Name:</label></td>
        <td>
          <select name="RegionName" [(ngModel)]="predictionRequest.RegionName" style="width:100%">
            <option *ngFor="let j of formData.Regionname" [value]="j">{{ j }}</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><label>Property Count:</label></td>
        <td><input name="PropertyCount" [(ngModel)]="predictionRequest.PropertyCount" style="width:100%" required type="number"></td>
      </tr>
      <tr>
        <td><label>Distance:</label></td>
        <td><input name="Distance" [(ngModel)]="predictionRequest.Distance" style="width:100%" required type="number"></td>
      </tr>
      <tr>
        <td><label>Council Area:</label></td>
        <td>
          <select name="CouncilArea" [(ngModel)]="predictionRequest.CouncilArea" style="width:100%">
            <option *ngFor="let j of formData.CouncilArea" [value]="j">{{ j }}</option>
          </select>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <p>
            <button type="submit" class="btn btn-primary">Predict</button>
          </p>
        </td>
      </tr>
    </tbody>
  </table>
</form>

<div *ngIf="isError" style="display: block; color:red; font-weight:bold; align-content:center">
  <p>
    <img src="/images/ouch.png" />
  </p>
  <p>
    {{errorMessage}}
  </p>
</div>

<div *ngIf="prediction && !isError" style="display: block" id="resultsView">
  <hr  />
  <h2>Predicted value: {{prediction.prediction | currency:'AUD':'\$':'1.0-0'}} AUD</h2>
  The individual feature contributions to the final prediction is detailed in the bar char below.
  <canvas baseChart
          [datasets]="barChartData"
          [labels]="barChartLabels"
          [options]="barChartOptions"
          [plugins]="barChartPlugins"
          [legend]="barChartLegend"
          [chartType]="barChartType"></canvas>
  <hr />
  <h2>How is the prediction calculated?</h2>
  <table class="" style="width: 0%; text-align:right;">
    <tr style="border-bottom: 1px solid silver;" placement="top" ngbTooltip="The global mean is the basis for the calculation. All feature contributions are summed with this base value">
      <td><b>Global mean:</b></td>
      <td><b>{{prediction.globalMean | currency:'AUD':'\$':'1.0-0'}}</b></td>
    </tr>
    <tr placement="right" ngbTooltip="The given suburb {{AddOrSubtract(prediction.suburb)}} {{Abs(prediction.suburb) | currency:'AUD':'\$':'1.0-0'}} ">
      <td>Suburb:</td>
      <td >{{prediction.suburb | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given number of rooms {{AddOrSubtract(prediction.rooms)}} {{Abs(prediction.rooms) | currency:'AUD':'\$':'1.0-0'}} ">
      <td>Rooms:</td>
      <td>{{prediction.rooms | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given house type {{AddOrSubtract(prediction.type)}} {{Abs(prediction.type) | currency:'AUD':'\$':'1.0-0'}} ">
      <td>Type:</td>
      <td>{{prediction.type | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given method of sale {{AddOrSubtract(prediction.method)}} {{Abs(prediction.method) | currency:'AUD':'\$':'1.0-0'}} ">
      <td>Method:</td>
      <td>{{prediction.method | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given postcode {{AddOrSubtract(prediction.postcode)}} {{Abs(prediction.postcode) | currency:'AUD':'\$':'1.0-0'}} ">
      <td>Post Code:</td>
      <td>{{prediction.postcode | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given region name {{AddOrSubtract(prediction.regionname)}} {{Abs(prediction.regionname) | currency:'AUD':'\$':'1.0-0'}} ">
      <td>Region Name:</td>
      <td>{{prediction.regionname | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given number of properties in the suburb {{AddOrSubtract(prediction.propertycount)}} {{Abs(prediction.propertycount) | currency:'AUD':'\$':'1.0-0'}} ">
      <td>Property Count:</td>
      <td>{{prediction.propertycount | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given distance from CBD (central business district) {{AddOrSubtract(prediction.distance)}} {{Abs(prediction.distance) | currency:'AUD':'\$':'1.0-0'}} ">
      <td>Distance:</td>
      <td>{{prediction.distance | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given council area {{AddOrSubtract(prediction.councilArea)}} {{Abs(prediction.councilArea) | currency:'AUD':'\$':'1.0-0'}}">
      <td>Council Area:</td>
      <td>{{prediction.councilArea | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>

    <tr placement="right" ngbTooltip="The given month {{AddOrSubtract(prediction.month)}} {{Abs(prediction.month) | currency:'AUD':'\$':'1.0-0'}}">
      <td>Month:</td>
      <td>{{prediction.month | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>
    <tr placement="right" ngbTooltip="The given year {{AddOrSubtract(prediction.year)}}  {{Abs(prediction.year) | currency:'AUD':'\$':'1.0-0'}}">
      <td>Year:</td>
      <td>{{prediction.year | currency:'AUD':'\$':'1.0-0'}}</td>
    </tr>

    <tr style="border-top: 1px solid silver;" placement="right" ngbTooltip="The sum of all the contributions above amounts to a predicted house value of {{prediction.prediction | currency:'AUD':'\$':'1.0-0'}}">
      <td><b>Sum:</b></td>
      <td><b>{{prediction.prediction | currency:'AUD':'\$':'1.0-0'}}</b></td>
    </tr>

  </table>
  <hr *ngIf="scrollToResultsView()" />
  <p></p>

</div>
